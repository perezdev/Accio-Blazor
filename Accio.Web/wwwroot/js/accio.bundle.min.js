function InitializeAdvancedPage(){InitializeAdvancedSearchElements();InitializeSearchBoxOnNonSearchPage()}function InitializeAdvancedSearchElements(){$(advancedSearchElements.CardNameId+","+advancedSearchElements.CardTextId).on("keypress",function(n){n.which===13&&(RedirectToSearchWithAdvancedSearchString(),n.preventDefault())})}function RedirectToSearchWithAdvancedSearchString(){var t=$(advancedSearchElements.CardNameId).val(),i=$(advancedSearchElements.CardTextId).val(),n=new FormData;t&&n.append("cardName",t);i&&n.append("cardText",i);$.ajax({type:"POST",url:"Advanced?handler=GetAdvancedSearchUrlValue",data:n,beforeSend:function(n){n.setRequestHeader("XSRF-TOKEN",$('input:hidden[name="__RequestVerificationToken"]').val())},contentType:!1,processData:!1,success:function(n){if(n.success){var t=n.json,i=location.protocol+"//"+location.host,r="/Search?adv="+t;window.location.href=i+r}},failure:function(){alert("Catastropic error")}})}function InitializeCardPage(){InitializeSearchBoxOnNonSearchPage()}function InitializeLayout(){InitializeLayouElements()}function InitializeLayouElements(){$(searchElementNames.SearchInputId).on("keyup",function(){var n=$(searchElementNames.ClearSearchClassName);$(this).val()===""?n.hasClass("vh")||n.addClass("vh"):n.hasClass("vh")&&n.removeClass("vh")});$(searchElementNames.ClearSearchClassName).on("click",function(){var n=$(searchElementNames.SearchInputId);n.val("");$(this).addClass("vh")})}function GetCurrentPage(){return window.location.pathname.split("/")[1]}function InitializeSearchBoxOnNonSearchPage(){$(searchElementNames.SearchInputId).on("keypress",function(n){n.which===13&&(window.location.href="/Search?searchText="+$(this).val()+"&sortBy=sn&cardView=images",n.preventDefault())})}function getParameterByName(n,t){t||(t=window.location.href);n=n.replace(/[\[\]]/g,"\\$&");var r=new RegExp("[?&]"+n+"(=([^&#]*)|&|#|$)"),i=r.exec(t);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null}function until(n){const t=i=>{n()?i():setTimeout(()=>t(i),400)};return new Promise(t)}function InitializeHomePage(){InitializeSearchBoxOnNonSearchPage()}function InitializeSearchPage(){SetCardSets();InitializeCardSearchElements();SetValuesFromQueryAndPeformCardSearch();InitializeCardTable()}function SetCardSets(){$.ajax({type:"POST",url:"Search?handler=GetSets",beforeSend:function(n){n.setRequestHeader("XSRF-TOKEN",$('input:hidden[name="__RequestVerificationToken"]').val())},contentType:!1,processData:!1,success:function(n){if(n.success){var t=n.json;AddSetsToDropDown(t)}},failure:function(){alert("Catastropic error")}})}function AddSetsToDropDown(n){var i="#setSelect",u,t;for($(i).find("option").remove(),u='<option value="00000000-0000-0000-0000-000000000000">All Sets<\/option>',$(i).append(u),t=0;t<n.length;t++){var r=n[t],e="/images/seticons/"+r.iconFileName,f='<option value="'+r.setId+'">'+r.name+"<\/option>";$(i).append(f)}hasSetsLoaded=!0}function InitializeCardSearchElements(){$(searchElementNames.SearchInputId).on("keypress",function(n){n.which===13&&(SearchCards(),n.preventDefault())});$(searchElementNames.SetId).on("change",function(){SearchCards()});$(searchElementNames.CardViewId).on("change",function(){ToggleViewSearch()});$(searchElementNames.SortCardsById).on("change",function(){var n=GetSearchData();(n.SetId||n.LessonCost||n.SearchText)&&n.SortBy&&SearchCards()});$(searchElementNames.SortCardsOrderId).on("change",function(){var n=GetSearchData();(n.SetId||n.LessonCost||n.SearchText)&&SearchCards()})}function InitializeCardTable(){var n=$.fn.dataTable.absoluteOrder({value:"",position:"bottom"});cardTable=$(resultsContainerNames.CardTableId).DataTable({lengthChange:!1,searching:!1,paging:!1,bInfo:!1,columnDefs:[{targets:[CardTableColumnIndex.CardId,CardTableColumnIndex.ImageUrl,CardTableColumnIndex.Lesson],visible:!1},{targets:[CardTableColumnIndex.Number],type:"natural-nohtml"},{targets:[CardTableColumnIndex.Lesson],type:n}],createdRow:function(n,t){$("td",n).on("mouseover",function(){var i=t[CardTableColumnIndex.ImageUrl],u=t[CardTableColumnIndex.CardId],n=$(singleCardSearchElementIds.HoverImageClassName),r;n.attr("src")!==i&&(r=GetCardFromCardId(u),r.orientation==="Horizontal"&&n.addClass("hover-card-rotate"),n.attr("src",""),n.removeClass("dn"),n.attr("src",i))});$("td",n).on("mouseleave",function(){var n=$(singleCardSearchElementIds.HoverImageClassName);n.addClass("dn");n.removeClass("hover-card-rotate")})}});$(resultsContainerNames.CardTableId+" tbody").on("click","tr",function(){for(var t,i,r=cardTable.row(this).data(),n=0;n<cards.length;n++)t=cards[n],t.cardId===r[0]&&(i=location.protocol+"//"+location.host,window.location.href=i+t.cardPageUrl)})}function GetCardFromCardId(n){for(var i,r=null,t=0;t<this.cards.length;t++)i=cards[t],i.cardId===n&&(r=i);return r}function SearchCards(){HideAllContainers();ToggleSearchLoading();const n=GetSearchData();SetQueryFromValues(n);ToggleSearchResultData();var t=new FormData;n.SetId&&t.append("setId",n.SetId);n.SearchText&&t.append("searchText",n.SearchText);n.SortBy&&t.append("sortBy",n.SortBy);n.SortOrder&&t.append("sortOrder",n.SortOrder);$.ajax({type:"POST",url:"Search?handler=SearchCards",data:t,beforeSend:function(n){n.setRequestHeader("XSRF-TOKEN",$('input:hidden[name="__RequestVerificationToken"]').val())},contentType:!1,processData:!1,success:function(n){n.success&&(ToggleSearchLoading(),UnHideAllContainers(),cards=n.json,$(searchElementNames.CardCountId).html(cards.length+" cards"),AddCardsToContainer(cards))},failure:function(){alert("Catastropic error")}})}async function SetValuesFromQueryAndPeformCardSearch(){var n=getParameterByName(searchQueryParameterNames.SetId),t=getParameterByName(searchQueryParameterNames.SearchText),i=getParameterByName(searchQueryParameterNames.SortBy),r=getParameterByName(searchQueryParameterNames.SortOrder),u=getParameterByName(searchQueryParameterNames.CardView);t&&$(searchElementNames.SearchInputId).val(t);i&&$(searchElementNames.SortCardsById).val(i);r&&$(searchElementNames.SortCardsOrderId).val(r);u&&$(searchElementNames.CardViewId).val(u);n&&(await until(()=>hasSetsLoaded===!0),$(searchElementNames.SetId).val(n));n||t?SearchCards():PopulateDefaultCards()}function GetSearchData(){var n=$(searchElementNames.SetId).val(),t=$(searchElementNames.SearchInputId).val().trim(),i=$(searchElementNames.SortCardsById).val(),r=$(searchElementNames.SortCardsOrderId).val(),u=$(searchElementNames.CardViewId).val();(n==="00000000-0000-0000-0000-000000000000"||n==="")&&(n=null);return{SetId:n,SearchText:t,SortBy:i,SortOrder:r,CardView:u}}function PopulateDefaultCards(){HideAllContainers();ToggleSearchLoading();$.ajax({type:"POST",url:"Search?handler=GetPopularCards",beforeSend:function(n){n.setRequestHeader("XSRF-TOKEN",$('input:hidden[name="__RequestVerificationToken"]').val())},contentType:!1,processData:!1,success:function(n){n.success&&(ToggleSearchLoading(),UnHideAllContainers(),cards=n.json,AddCardsToContainer(cards))},failure:function(){alert("Catastropic error")}})}function ToggleViewSearch(){if(cards!==null){const n=GetSearchData();SetQueryFromValues(n);AddCardsToContainer(cards)}else SearchCards()}function ToggleViewContainers(){var t=$(resultsContainerNames.NoCardsContainerId),n;t.hasClass("dn")||t.addClass("dn");n=$(searchElementNames.CardViewId).val();n==="images"?($(resultsContainerNames.CardTableContainerId).removeClass("db"),$(resultsContainerNames.CardTableContainerId).addClass("dn"),$(resultsContainerNames.CardContainerId).removeClass("dn"),$(resultsContainerNames.CardContainerId).addClass("flex")):n==="listview"&&($(resultsContainerNames.CardContainerId).removeClass("flex"),$(resultsContainerNames.CardContainerId).addClass("dn"),$(resultsContainerNames.CardTableContainerId).removeClass("dn"),$(resultsContainerNames.CardTableContainerId).addClass("db"))}function ToggleSearchResultData(){var t=getParameterByName(searchQueryParameterNames.SetId),i=getParameterByName(searchQueryParameterNames.SearchText),n;$(resultsContainerNames.SearchResultsContainerId).removeClass("dn");$(resultsContainerNames.SetInfoContainerId).removeClass("dn");t&&!i?($(resultsContainerNames.SearchResultsContainerId).addClass("dn"),n=new FormData,n.append("setId",t),$.ajax({type:"POST",url:"Search?handler=GetSetBySetId",data:n,beforeSend:function(n){n.setRequestHeader("XSRF-TOKEN",$('input:hidden[name="__RequestVerificationToken"]').val())},contentType:!1,processData:!1,success:function(n){var t,i;n.success&&(t=n.json,$(resultsContainerNames.SetHeaderIconClassName).attr("data","/images/seticons/"+t.iconFileName),$(resultsContainerNames.SetHeaderTitleClassName).html(t.name),i=t.totalCards+" cards â€¢ Released "+t.releaseDate,$(resultsContainerNames.SetHeaderDataClassName).html(i))},failure:function(){alert("Catastropic error")}})):$(resultsContainerNames.SetInfoContainerId).addClass("dn")}function AddCardsToContainer(n){n.length<=0?$(resultsContainerNames.NoCardsContainerId).removeClass("dn"):ToggleViewContainers();var t=$(searchElementNames.CardViewId).val();t==="images"?AddCardsToDeck(n):t==="listview"&&AddCardsToTable(n)}function AddCardsToDeck(n){var i;for($(resultsContainerNames.CardContainerId).html(""),i=0;i<n.length;i++){var t=n[i],u=GetImageFromCardImages(t,ImageSizeType.Small),f=t.orientation==="Horizontal"?'onmouseover="RotateCardHorizontally(this);" onmouseleave="RotateCardVertically(this);"':"",e=location.protocol+"//"+location.host+t.cardPageUrl,o=`
                        <a `+f+` href="`+e+`" class="card-image w-25-ns pa1 w-50">
                            <img class="card-image tc" id="`+t.cardId+`" data-cardname="`+t.detail.name+`" src="`+u.url+`" />
                        </a>
                    `,r=$(resultsContainerNames.CardContainerId).html();r+=o;$(resultsContainerNames.CardContainerId).html(r);$(".card-image").on("load",function(){$(this).removeClass("d-none");$(this).addClass("animated fadeIn")}).on("error",function(){}).each(function(){this.complete?$(this).trigger("load"):this.error&&$(this).trigger("error")})}}function AddCardsToTable(n){var i,o,s,r,h,c,b;for(cardTable.clear().draw(),i=0;i<n.length;i++){var t=n[i],l=t.cardId,u=t.lessonCost===null?"":t.lessonCost,a=GetSetIconImageElement(t.cardSet.iconFileName),v=t.cardNumber,y="<b>"+t.detail.name+"<\/b>",p=GetImageFromCardImages(t,ImageSizeType.Small),w=p.url,e="",f=null;t.lessonType===null?f=u:t.lessonType!==null&&u!==""&&(o=GetLessonImageElementFromLessonType(t.lessonType.name),f='<label class="card-table-cell-lesson-label">'+u+"<\/label>"+o,e=t.lessonType.name);s=t.cardType.name;r=null;t.rarity.imageName===null?r=t.rarity.symbol:(h=GetRarityImageElement(t.rarity.imageName),r=t.rarity.symbol+h);c=t.detail.illustrator;b=cardTable.row.add([l,a,v,y,f,s,r,c,w,e])}ApplySortToCardTable();cardTable.rows().every(function(t){for(var i,u,f=$(this.node()),e=cardTable.cell(t,CardTableColumnIndex.CardId).data(),r=0;r<n.length;r++)i=n[r],i.cardId===e&&i.lessonType!==null&&(u=GetLessonColorClass(i),f.find("td").eq(CardTableColumnIndex.Cost-1).addClass(u))})}function ApplySortToCardTable(){var t=$(searchElementNames.SortCardsById).val(),n=$(searchElementNames.SortCardsOrderId).val();t===SortBy.SetNumber?cardTable.order([CardTableColumnIndex.Set,n],[CardTableColumnIndex.Number,n]).draw():t===SortBy.Name?cardTable.order([CardTableColumnIndex.Name,n]).draw():t===SortBy.Cost?cardTable.order([CardTableColumnIndex.Cost,n]).draw():t===SortBy.Type?cardTable.order([CardTableColumnIndex.Type,n]).draw():t===SortBy.Rarity?cardTable.order([CardTableColumnIndex.Rarity,n]).draw():t===SortBy.Artist?cardTable.order([CardTableColumnIndex.Artist,n]).draw():t===SortBy.Lesson&&cardTable.order([CardTableColumnIndex.Lesson,n],[CardTableColumnIndex.Name,n]).draw()}function GetLessonImageElementFromLessonType(n){return n===LessonTypeName.CareOfMagicalCreatures?'<img class="card-table-cell-lesson-image" src="/images/lessons/care-of-magical-creatures.svg" />':n===LessonTypeName.Charms?'<img class="card-table-cell-lesson-image" src="/images/lessons/charms.svg" />':n===LessonTypeName.Potions?'<img class="card-table-cell-lesson-image" src="/images/lessons/potions.svg" />':n===LessonTypeName.Quidditch?'<img class="card-table-cell-lesson-image" src="/images/lessons/quidditch.svg" />':n===LessonTypeName.Transfiguration?'<img class="card-table-cell-lesson-image" src="/images/lessons/transfiguration.svg" />':void 0}function GetRarityImageElement(n){return'<img class="card-table-cell-rarity-image" src="/images/rarities/'+n+'" />'}function GetSetIconImageElement(n){return'<img class="card-table-cell-icon-image" src="/images/seticons/'+n+'" />'}function RotateCardHorizontally(n){n.style.transform="rotate(90deg)";n.style.position="relative";n.style.zIndex="9999"}function RotateCardVertically(n){n.style.transform="rotate(0deg)";n.style.zIndex="0"}function SetQueryFromValues(n){if(n.SetId||n.LessonCost||n.SearchText){var i=window.location.href.split("?")[0],t="?";n.SetId&&(t+=searchQueryParameterNames.SetId+"="+n.SetId+"&");n.SearchText&&(t+=searchQueryParameterNames.SearchText+"="+n.SearchText+"&");n.SortBy&&(t+=searchQueryParameterNames.SortBy+"="+n.SortBy+"&");n.SortOrder&&(t+=searchQueryParameterNames.SortOrder+"="+n.SortOrder+"&");n.CardView&&(t+=searchQueryParameterNames.CardView+"="+n.CardView+"&");t=t.slice("&",-1);history.pushState(null,null,i+t)}}function GetLessonColorClass(n){if(n.lessonCost===null||n.lessonType===null)return"";var t=n.lessonType;return t.name===LessonTypeName.CareOfMagicalCreatures?"lesson-color-comc":t.name===LessonTypeName.Charms?"lesson-color-charms":t.name===LessonTypeName.Potions?"lesson-color-potions":t.name===LessonTypeName.Quidditch?"lesson-color-quidditch":t.name===LessonTypeName.Transfiguration?"lesson-color-transfig":void 0}function ToggleSearchLoading(){var n=$("#loading");n.hasClass("dn")?n.removeClass("dn"):n.addClass("dn")}function HideAllContainers(){var n=$(resultsContainerNames.CardTableContainerId),t=$(resultsContainerNames.CardContainerId),i=$(resultsContainerNames.NoCardsContainerId);n.hasClass("vh")||n.addClass("vh");t.hasClass("vh")||t.addClass("vh");i.hasClass("vh")||i.addClass("vh")}function UnHideAllContainers(){var n=$(resultsContainerNames.CardTableContainerId),t=$(resultsContainerNames.CardContainerId),i=$(resultsContainerNames.NoCardsContainerId);n.hasClass("vh")&&n.removeClass("vh");t.hasClass("vh")&&t.removeClass("vh");i.hasClass("vh")&&i.removeClass("vh")}function GetImageFromCardImages(n,t){for(var r,u=n.images,i=0;i<u.length;i++)if(r=u[i],r.size===t)return r}function InitializeSetsPage(){InitializeSetsTable();PopulateSetsTable();InitializeSearchBoxOnNonSearchPage()}function InitializeSetsTable(){console.log(setsPageElements.SetsTableId);setsTable=$(setsPageElements.SetsTableId).DataTable({lengthChange:!1,searching:!1,paging:!1,bInfo:!1,columnDefs:[{targets:[0],visible:!1},{targets:[1],className:"fl w-100"},{targets:[2,3],width:"10%"},{targets:[4],className:"v-mid"}]});$(setsPageElements.SetsTableId+" tbody").on("click","tr",function(){var n=setsTable.row(this).data();window.location.href="/Search?setId="+n[0]+"&sortBy=sn&cardView=images"})}function PopulateSetsTable(){$.ajax({type:"POST",url:"Sets?handler=GetSets",beforeSend:function(n){n.setRequestHeader("XSRF-TOKEN",$('input:hidden[name="__RequestVerificationToken"]').val())},contentType:!1,processData:!1,success:function(n){if(n.success){var t=n.json;AddSetsToSetsTable(t)}},failure:function(){alert("Catastropic error")}})}function AddSetsToSetsTable(n){for(var r,f,e,o,a,i=0;i<n.length;i++){var t=n[i],s=t.setId,h='<div class="flex items-center"><img class="sets-set-table-set-icon" src="/images/seticons/'+t.iconFileName+'" /><div>'+t.name+"<\/div><\/div>",c=t.totalCards,l=t.releaseDate,u='<div class="flex items-center">';for(r=0;r<t.languages.length;r++)f=t.languages[r],e="",e=f.enabled?"set-language-enabled":"set-language-disabled",u+='<div class="'+e+'">'+f.code+"<\/div>";u+="<\/div>";o=u;a=setsTable.row.add([s,h,c,l,o]);setsTable.order([SetsTableColumnIndex.ReleaseDate,"desc"]).draw()}}var currentPage,hasSetsLoaded,cards,cardTable,setsTable;const advancedSearchElements={CardNameId:"#cardName",CardTextId:"#cardText"};currentPage=null;const Page={Home:"",Search:"Search",Card:"Card",Sets:"Sets",Advanced:"Advanced"};$(document).ready(function(){InitializeLayout();currentPage=GetCurrentPage();currentPage===Page.Home?InitializeHomePage():currentPage===Page.Search?InitializeSearchPage():currentPage===Page.Card?InitializeCardPage():currentPage===Page.Sets?InitializeSetsPage():currentPage===Page.Advanced&&InitializeAdvancedPage()});const searchQueryParameterNames={SetId:"setId",SearchText:"searchText",SortBy:"sortBy",SortOrder:"sortOrder",CardView:"cardView",CardId:"cardId"},searchElementNames={SetId:"#setSelect",SearchInputId:"#searchInput",SortCardsById:"#sortCardsBy",CardModalId:"#cardModal",SortCardsOrderId:"#sortCardsOrder",CardViewId:"#cardView",CardCountId:"#cardCount",SetDateClassName:".set-date",ClearSearchClassName:".clear-search",HoverImageClassName:".hover-card"},resultsContainerNames={ContentContainerId:"#contentContainer",CardContainerId:"#cardContainer",CardTableId:"#cardTable",CardTableContainerId:"#tableContainer",SearchResultsContainerId:"#searchResults",SetInfoContainerId:"#setInfo",SetHeaderIconClassName:".set-header-title-icon",SetHeaderTitleClassName:".set-header-title-h1",SetHeaderDataClassName:".set-header-title-data",NoCardsContainerId:"#noCardsContainer"},ImageSizeType={Small:0,Medium:1,Large:2},CardTableColumnIndex={CardId:0,Set:1,Number:2,Name:3,Cost:4,Type:5,Rarity:6,Artist:7,ImageUrl:8,Lesson:9},SortBy={SetNumber:"sn",Name:"name",Cost:"cost",Type:"type",Rarity:"rarity",Artist:"artist",Lesson:"lesson"},SortOrder={Ascending:"asc",Descending:"desc"},LessonTypeName={CareOfMagicalCreatures:"Care of Magical Creatures",Charms:"Charms",Potions:"Potions",Quidditch:"Quidditch",Transfiguration:"Transfiguration"};$(document).mousemove(function(n){var t=$(searchElementNames.HoverImageClassName),i=window.scrollY;t.css({top:i+n.clientY,left:n.clientX+20})});hasSetsLoaded=!1;cards=null;cardTable=null;const setsPageElements={SetsTableId:"#setsTable"},SetsTableColumnIndex={SetId:0,Name:1,TotalCards:2,ReleaseDate:3,Languages:4};setsTable=null;